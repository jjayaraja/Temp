# Connect to your SharePoint Online site
Connect-PnPOnline -Url "https://yourtenant.sharepoint.com/sites/yoursite" -Interactive

# Your document library name
$listName = "Documents"

# Get all items from the list (files + folders)
$items = Get-PnPListItem -List $listName -PageSize 2000 -Fields "FileRef", "FileSystemObjectType"

foreach ($item in $items) {
    $itemId = $item.Id
    $fileRef = $item.FieldValues["FileRef"]

    try {
        # Reset inheritance using this method
        Invoke-PnPQuery
        Invoke-PnPProperty -Object $item -Property RoleAssignments
        $item.ResetRoleInheritance()

        Write-Host "✔ Inheritance reset: $fileRef" -ForegroundColor Green
    }
    catch {
        Write-Warning "❌ Failed to reset permissions for $fileRef: $_"
    }
}
