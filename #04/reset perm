# Connect to your SharePoint site
Connect-PnPOnline -Url "https://yourtenant.sharepoint.com/sites/yoursite" -Interactive

# Set your document library name
$libraryName = "Documents"

# Get all items recursively from the library
$items = Get-PnPListItem -List $libraryName -PageSize 2000 -Fields "FileRef", "FileSystemObjectType"

foreach ($item in $items) {
    $fileRef = $item.FieldValues["FileRef"]
    $itemId = $item.Id

    try {
        # Reset permission inheritance (removes unique permissions)
        Invoke-PnPQuery
        Set-PnPListItem -List $libraryName -Identity $itemId -ClearUniqueRoleAssignments

        Write-Host "✔ Permissions inherited for: $fileRef" -ForegroundColor Green
    }
    catch {
        Write-Warning "❌ Failed to set inheritance for $fileRef: $_"
    }
}
